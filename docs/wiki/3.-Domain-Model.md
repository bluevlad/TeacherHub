# 3. 도메인 모델 (Domain Model)

## 3.1 ER 다이어그램

```
┌──────────────────┐       ┌──────────────────┐
│    academies     │       │    subjects      │
├──────────────────┤       ├──────────────────┤
│ id (PK)          │       │ id (PK)          │
│ name             │       │ name             │
│ short_name       │       │ created_at       │
│ website_url      │       └──────────────────┘
│ created_at       │               │
└──────────────────┘               │
        │                          │
        │ 1:N                      │ 1:N
        ▼                          ▼
┌──────────────────────────────────────────────┐
│                  teachers                     │
├──────────────────────────────────────────────┤
│ id (PK)                                       │
│ name                                          │
│ academy_id (FK) ─────────────────────────────┘
│ subject_id (FK)                               │
│ aliases (JSON)                                │
│ is_active                                     │
│ created_at                                    │
└──────────────────────────────────────────────┘
        │
        │ 1:N
        ▼
┌──────────────────────────────────────────────┐
│              teacher_mentions                 │
├──────────────────────────────────────────────┤
│ id (PK)                                       │
│ teacher_id (FK)                               │
│ post_id (FK) ────────────────────────────────┐
│ mention_context                               │
│ sentiment_score                               │
│ sentiment_label                               │
│ is_recommendation                             │
│ created_at                                    │
└──────────────────────────────────────────────┘
                                                │
┌──────────────────────────────────────────────┐
│                   posts                       │
├──────────────────────────────────────────────┤
│ id (PK)                                       │
│ source_site                                   │
│ post_id                                       │
│ title                                         │
│ content                                       │
│ author                                        │
│ view_count                                    │
│ like_count                                    │
│ comment_count                                 │
│ posted_at                                     │
│ crawled_at                                    │
└──────────────────────────────────────────────┘
        │
        │ Aggregated
        ▼
┌──────────────────────────────────────────────┐
│               daily_reports                   │
├──────────────────────────────────────────────┤
│ id (PK)                                       │
│ teacher_id (FK)                               │
│ report_date                                   │
│ mention_count                                 │
│ positive_count                                │
│ negative_count                                │
│ neutral_count                                 │
│ recommendation_count                          │
│ avg_sentiment_score                           │
│ created_at                                    │
└──────────────────────────────────────────────┘
```

---

## 3.2 엔티티 상세

### academies (학원)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| name | VARCHAR(100) | 학원명 | 에듀윌 |
| short_name | VARCHAR(20) | 약어 | eduwill |
| website_url | VARCHAR(255) | 홈페이지 | https://www.eduwill.net |
| created_at | TIMESTAMP | 생성일 | 2026-01-01 |

### subjects (과목)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| name | VARCHAR(50) | 과목명 | 국어 |
| created_at | TIMESTAMP | 생성일 | 2026-01-01 |

### teachers (강사)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| name | VARCHAR(100) | 강사명 | 홍길동 |
| academy_id | BIGINT | FK (academies) | 1 |
| subject_id | BIGINT | FK (subjects) | 1 |
| aliases | JSONB | 별명 목록 | ["길동쌤", "홍쌤"] |
| is_active | BOOLEAN | 활성 여부 | true |
| created_at | TIMESTAMP | 생성일 | 2026-01-01 |

### posts (게시글)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| source_site | VARCHAR(50) | 출처 사이트 | dcinside |
| post_id | VARCHAR(100) | 원본 게시글 ID | 12345678 |
| title | VARCHAR(500) | 제목 | 국어 강사 추천 |
| content | TEXT | 내용 | ... |
| author | VARCHAR(100) | 작성자 | ㅇㅇ |
| view_count | INTEGER | 조회수 | 150 |
| like_count | INTEGER | 추천수 | 5 |
| comment_count | INTEGER | 댓글수 | 10 |
| posted_at | TIMESTAMP | 작성일 | 2026-02-01 |
| crawled_at | TIMESTAMP | 수집일 | 2026-02-01 |

### teacher_mentions (강사 언급)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| teacher_id | BIGINT | FK (teachers) | 1 |
| post_id | BIGINT | FK (posts) | 1 |
| mention_context | TEXT | 언급 맥락 | 홍길동 선생님 추천 |
| sentiment_score | FLOAT | 감성 점수 | 0.8 |
| sentiment_label | VARCHAR(20) | 감성 라벨 | positive |
| is_recommendation | BOOLEAN | 추천 여부 | true |
| created_at | TIMESTAMP | 생성일 | 2026-02-01 |

### daily_reports (일일 리포트)

| 컬럼 | 타입 | 설명 | 예시 |
|------|------|------|------|
| id | BIGINT | PK | 1 |
| teacher_id | BIGINT | FK (teachers) | 1 |
| report_date | DATE | 리포트 날짜 | 2026-02-01 |
| mention_count | INTEGER | 언급 수 | 10 |
| positive_count | INTEGER | 긍정 수 | 6 |
| negative_count | INTEGER | 부정 수 | 2 |
| neutral_count | INTEGER | 중립 수 | 2 |
| recommendation_count | INTEGER | 추천 수 | 3 |
| avg_sentiment_score | FLOAT | 평균 감성 점수 | 0.6 |
| created_at | TIMESTAMP | 생성일 | 2026-02-01 |

---

## 3.3 DTO 구조

### PeriodReportDTO

기간별 리포트 응답 DTO

```java
public class PeriodReportDTO {
    private String periodType;       // daily, weekly, monthly
    private LocalDate startDate;
    private LocalDate endDate;
    private String periodLabel;      // "2026년 2월 1주차"
    private Integer year;
    private Integer month;
    private Integer week;

    // 전체 통계
    private Integer totalTeachers;
    private Integer totalMentions;
    private Integer totalPositive;
    private Integer totalNegative;
    private Integer totalNeutral;
    private Double avgSentimentScore;
    private Double positiveRatio;

    // 강사별 집계
    private List<PeriodSummaryDTO> teacherSummaries;
}
```

### PeriodSummaryDTO

강사별 집계 DTO

```java
public class PeriodSummaryDTO {
    private Long teacherId;
    private String teacherName;
    private String academyName;
    private String subjectName;

    private Integer mentionCount;
    private Integer positiveCount;
    private Integer negativeCount;
    private Integer neutralCount;
    private Integer recommendationCount;
    private Double avgSentimentScore;
    private Integer reportDays;
}
```

---

## 3.4 감성 분석 기준

### Sentiment Score

| 점수 범위 | 라벨 | 설명 |
|----------|------|------|
| 0.1 ~ 1.0 | positive | 긍정적 |
| -0.1 ~ 0.1 | neutral | 중립적 |
| -1.0 ~ -0.1 | negative | 부정적 |

### 추천 키워드

게시글에서 다음 키워드가 발견되면 `is_recommendation = true`:

- 추천
- 강추
- 좋아요
- 최고
- 믿고 들어
- 인생 강의

---

## 3.5 집계 연산

### 일별 집계 (Daily)

```sql
SELECT * FROM daily_reports
WHERE report_date = :date
```

### 주별 집계 (Weekly)

```sql
SELECT
    teacher_id,
    SUM(mention_count) as total_mentions,
    SUM(positive_count) as total_positive,
    AVG(avg_sentiment_score) as avg_score
FROM daily_reports
WHERE report_date BETWEEN :start_date AND :end_date
GROUP BY teacher_id
```

### 월별 집계 (Monthly)

```sql
SELECT
    teacher_id,
    SUM(mention_count) as total_mentions,
    COUNT(DISTINCT report_date) as report_days
FROM daily_reports
WHERE EXTRACT(YEAR FROM report_date) = :year
  AND EXTRACT(MONTH FROM report_date) = :month
GROUP BY teacher_id
```

---

[← 아키텍처](./2.-Architecture) | [다음: API 명세 →](./4.-API-Specification)
